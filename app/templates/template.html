<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>proof of concept - quite good considering</title>
  </head>
  <body>
    Running project #{{name}}!


    <script type='text/javascript'>
      if (window.Worker) {
        // var getUrl = window.location;
        // var baseUrl = getUrl .protocol + "//" + getUrl.host + "/" + getUrl.pathname.split('/')[1];
        const myWorker = new Worker('/api/get_worker/worker.js');
      myWorker.postMessage('{{name}}');
      var worker_done = false
      myWorker.onmessage = function(e) {
        result =  e.data;
        console.log('Message received from worker: ' + result);
        if (result != "No jobs") {
          myWorker.postMessage('{{name}}');
        } else {
          console.log('no more jobs, stopping exec.')
        }
      }
       } else {
        console.log('Your browser doesn\'t support web workers.');
      }
      // i =0
      // while (i <1 && worker_done) {
      //   myWorker.postMessage('{{name}}');
      // }
      
      //   const myWorker = new Worker("/api/get_worker/worker.js");

      //   // first.onchange = function() {
      //     myWorker.postMessage([1,1]);
      //     // console.log('Message posted to worker');
      //   // }

      //   // second.onchange = function() {
      //   //   myWorker.postMessage([first.value, second.value]);
      //   //   console.log('Message posted to worker');
      //   // }

      //   myWorker.onmessage = function(e) {
      //     result.textContent = e.data;
      //     console.log('Message received from worker');
      //   }
      // } else {
      //   console.log('Your browser doesn\'t support web workers.');
      // }
    

      // var do_break = false
      // i = 0;
      // // while (!do_break && i<5) {
      //   myWorker.port.postMessage('{{name}})');
      //   console.log('Message posted to worker');
        
      //   myWorker.port.onmessage = function(e) {
      //   result2.textContent = e.data;
      //   console.log('Message received from worker');
      // }

      //   get_and_run_job();
      //   console.log("break = " + do_break)
      //   setTimeout(function(){ 
      //     i++;
      //   }, 1000);
      // }
    </script>

    <script>
      function listCookies() {
          var theCookies = document.cookie.split(';');
          var aString = '';
          for (var i = 1 ; i <= theCookies.length; i++) {
              aString += i + ' ' + theCookies[i-1] + "\n";
          }
          return aString;
      }
      console.log(listCookies());
    </script>
  </body>
</html>


